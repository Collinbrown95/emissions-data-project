<html>
    <head>
        <title>Emissions Viewer</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="">
        <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

        <style>
            #map1, #map2 {width: 45%; height: 60%}
            #map1 {float: left;}
            #map2 {float: right;}
        </style>
    </head>
    <body>
        <div id="Container" style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center;">
            <h1 class="h1" style="padding: 1%;" >Emissions Viewer</h1>
            <div id="MapContainer" style="width: 100%; height: 90%; display: flex; flex-direction: row; align-items: flex-start; justify-content: space-evenly;">
                <div id="map1" class="leaflet-container leaflet-fade-anim leaflet-grab leaflet-touch-drag" tabindex="0"></div>
                <div id="map2" class="leaflet-container leaflet-fade-anim leaflet-grab leaflet-touch-drag" tabindex="0"></div>
                <script src="./L.Map.Sync.js"></script>
                <script src="emissionsTestData.js"></script>
            </div>
        </div>
        
        <script>
            var center = [59.336, 5.967];

            var layer1 = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                    '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                id: 'mapbox/streets-v11'
            })

            var layer2 = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                    '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                id: 'mapbox/streets-v11'
            })

            var map1 = L.map('map1', {
                layers: [layer1],
                center: center,
                zoom: 14
            });

            map1.attributionControl.setPrefix('');

            var map2 = L.map('map2', {
                layers: [layer2],
                center: center,
                zoom: 14,
                zoomControl: false
            });

            map1.sync(map2);
            map2.sync(map1);

            map1.setView([55.938183012205315, -116.6015625], 5);
            map2.setView([55.938183012205315, -116.6015625], 5);

            // Function to change the relative size of companies based on their total emissions
            function getIcon(totalEmissions) {
                // substitute real rescaling function below.
                var iconSize = (totalEmissions - 100000) / 25000;
                var companyIcon = new L.Icon({
                    iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/images/marker-shadow.png',
                    iconSize: [iconSize, iconSize*1.2],
                    // iconAnchor: [iconSize, iconSize+10],
                    // popupAnchor: [iconSize, iconSize+10],
                    shadowSize: [iconSize, iconSize*1.2]
                })
                return companyIcon;
            }

            function onEachFeature(feature, layer) {
                if (feature.properties){
                    // Add pop up with company info
                    layer.bindPopup("<h4>" + feature.properties.Name + '<br></h2>' 
                        + "<li>NAICS Code | " + feature.properties["NAICS Code"] + '<br></li>' 
                        + "<li>Flaring | " + feature.properties["Flaring"] + '<br></li>');
                    // Change size of icon based on total emissions
                    layer.setIcon(getIcon(feature.properties["TOTAL EMISSIONS (tonnes CO2e)"]));
                } 
            }

            L.geoJSON(geojsonTestData, {
                onEachFeature: onEachFeature
            }).addTo(map1);

            L.geoJSON(geojsonTestData, {
                onEachFeature: onEachFeature
            }).addTo(map2);

        </script>
    </body>
</html>